<%- include("../user/layouts/user_header.ejs") %>

    <main class="main"> 
      <div class="page-content">
        <div class="container"> 
          <a href="/orderList" style="float: right;">
            <button type="button" class="btn btn-primary btn-rounded"  style="color: rgb(7, 6, 5); float: none;  background-color:rgb(46, 202, 88); ">
              Goback  <<<
            </button>
             </a>
            <div class="products " style=" align-items: center;" >
              <div class="jumbotron jumbotron-fluid">
                
                <div class="container">
                  <h1 class="display-4">Hello <span style="color: #000; font-weight: 500;"><%= order.userName  %></span></h1>
                  <p class="lead">Order Id: <span style="color: #000; font-weight: 500;"><%= order.uniqId  %></span></p>
                  <p class="lead">Order date: <span style="color: #000; font-weight: 500;"><%= order.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: '2-digit' }).replace(/\//g, '-')  %></p></span>
                  <p class="lead">Paymentmethod: <span style="color: #000; font-weight: 500;"><%= order.paymentMethod  %></span> </p>
                  <p class="lead">Total price: <span style="color: #000; font-weight: 500;"><%= order.totalAmount  %>/-</span></p>
                  <p class="lead">Delivery address: <span style="color: #000; font-weight: 500;"><%= order.deliveryDetails %></span> </p>


                  <a href="/invoice/<%= order.id %>">
                    <button  type="button" class="btn btn-outline-primary btn-rounded "  style="color: black; border-color: rgb(46, 202, 88);">
                    Download invoice
                   </button>
                   </a>
                </div>
                
              </div>
              

                <div class="row">
                   
                        <% products.forEach((data)=>{ %>
                  
                            <div class="col-6 col-md-4 col-lg-4 col-xl-3 ">
                       
                                <div class="product product-11 text-center shadow-lg p-3 mb-5 bg-white rounded" >
                            
                                    <figure class="product-media">
                                        <a href="/product_details?id=<%= data.productId._id %>">
                                            <img style="max-height: 400px;" src="/adminassets/productImages/<%=data.productId.productImages[1] %>" alt="Product image" class="product-image-hover">
                                            <img style="max-height: 400px;" src="/adminassets/productImages/<%=data.productId.productImages[0]%>" alt="Product image" class="product-image">
                                        </a>
    
                                    </figure><!-- End .product-media -->
    
                                    <div class="product-body">
                                        <h3 class="product-title"><span style="font-weight: 600; font-size: 20px; color: #515151;"><%= data.productId.name %></span></h3><!-- End .product-title -->
                                        
                                        <div style="font-size:18px ; color: #000;  "><span style="color: rgb(79, 79, 79); font-family: monospace;"></span>
                                            <% if(data.status == "Delivered"){ %>
                                            <h6 style="color: rgb(120, 222, 18);">Delivered *</h6>
                                            <span style="color: rgb(0, 0, 0); font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;"><span style="font-size: medium;">Paid: <%= data.productId.price %>/-</span></span> 

                                            <a href="/returnProduct"><button  class="btn btn-outline-primary btn-rounded" type="button" style="color: black; border-color:rgb(46, 202, 88) ;" >Return?</button></a>

                                            <%}else{%>
                                                <span style="color: rgb(0, 0, 0); font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;"><span style="font-size: medium;" >Rs: <%= data.productId.price %>/-</span></span> 
                                                <% } %>
                                                <h6 style="color: chocolate;"><%= data.status %></h6>
                                                <!-- Button trigger modal -->
                                                <% if( data.status != "cancelled" && data.status != "Delivered" ){ %>
                                               <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#exampleModal-<%= data._id %>" > Cancel </button>                          
                                                
                                                   <% } %>
                                                     
                                        </div><!-- End .product-price -->
                                    </div><!-- End .product-body -->
                                    <!-- <div class="product-action ">
                                      
                                      
                                        <button onclick="addToCart('<%= data._id %>')" class="btn btn-outline-primary btn-rounded  "     data-target=".bd-example-modal-lg" ><span>add to cart</span></button>
                                     
                                  
                                    </div> -->
                            
                                </div><!-- End .product -->
                        
                        </div><!-- End .col-sm-6 col-lg-4 col-xl-3 -->
                        <div class="modal fade" id="exampleModal-<%= data._id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"  >
                          <div class="modal-dialog ">
                              <form action="/orderCancel" method="post">
                                  <input type="hidden" value="<%= data._id %>" name="orderid">
                                  <input type="hidden" value="<%= data.totalPrice %>" name="totalPrice">
                                  
                                  
                                 
                            <div class="modal-content" >
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Reason for cancel</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                  
                                 <p class="mx-5 mt-2 "> <input type="radio" value="Loss of interest"  name="reason" required> <span class="font-weight-bold">  Mind changed </span></p>
                                 <p class="mx-5"> <input type="radio" value="Unexpected Shipping costs" name="reason" required> <span class="font-weight-bold">  Unexpected Shipping costs  </span></p>
                                 <p class="mx-5 mb-2"> <input type="radio" value="other" name="reason" required><span class="font-weight-bold">  Arriving time is high </span></p>
                                 <p class="mx-5 mb-2"> <input type="radio" value="other" name="reason" required><span class="font-weight-bold">  other  </span></p>
                                 
                                </div>
                                <div class="modal-footer" style="border: none;">
                                <button type="button" class="btn-primary " data-bs-dismiss="modal" style="background-color: rgb(47, 255, 106);width: 5rem;border:none;">No</button>
                                <button type="submit" class="btn-primary " style=" width: 5rem;border:none;" >Yes</button>
                              </div>
                            </div>
                          </form>
                          </div>
                        </div>


                        <div class="modal fade" id="exampleModal-<%= data._id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"  >
                          <div class="modal-dialog ">
                              <form action="/orderCancel" method="post" id="checkout-form">
                                  <input type="hidden" value="<%= data._id %>" name="orderid">
                                  <input type="hidden" value="<%= data.totalPrice %>" name="totalPrice">
                                  <input type="hidden" value="<%= data.totalPrice %>" name="totalPrice">
                                  <input type="hidden" value="<%= data.paymentId %>" name="paymentId">


                                  
                                  
                                 
                            <div class="modal-content" >
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Reason for cancel</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                  
                                 <p class="mx-5 mt-2 "> <input type="radio" value="Loss of interest"  name="reason" required> <span class="font-weight-bold">  Mind changed </span></p>
                                 <p class="mx-5"> <input type="radio" value="Unexpected Shipping costs" name="reason" required> <span class="font-weight-bold">  Unexpected Shipping costs  </span></p>
                                 <p class="mx-5 mb-2"> <input type="radio" value="other" name="reason" required><span class="font-weight-bold">  Arriving time is high </span></p>
                                 <p class="mx-5 mb-2"> <input type="radio" value="other" name="reason" required><span class="font-weight-bold">  other  </span></p>
                                 
                                </div>
                                <div class="modal-footer" style="border: none;">
                                <button type="button" class="btn-primary " data-bs-dismiss="modal" style="background-color: rgb(47, 255, 106);width: 5rem;border:none;">No</button>
                                <button type="submit" class="btn-primary " style=" width: 5rem;border:none;" >Yes</button>
                              </div>
                            </div>
                          </form>
                          </div>
                        </div>
                      
                        
                        <% }) %>
                        
                        
                        
                        
                        
                        <!-- <div class="load-more-container text-center">
                          <a href="" class="btn btn-outline-darker btn-load-more">More Products <i class="icon-refresh"></i></a>
                        </div> -->
                        
                      </div>
                      
            </div><!-- End .products -->
          </div>
          </div>
          </main><!-- End .main -->
            <!-- Modal -->

<script>
  $("#checkout-form").submit((e) => {

let orderid = document.getElementById("orderid").innerHTML;
let total = document.getElementById("totalPrice").innerHTML;
let paymentId = document.getElementById("paymentId").innerHTML;// Modified to use jQuery instead of plain JavaScript
let reason = $("input[name=reason]:checked").val();

e.preventDefault();
$.ajax({
    url: "",
    method: "post",
    data: {
        Total: total,
        paymentId,
        orderid,
        reason,
    },

    success: (response) => {
        if (response.codsuccess == true) {
          razorPayment(response.order);
        }
    }
});
});

</script>
    

    <%- include("../user/layouts/user_footer.ejs") %>
    